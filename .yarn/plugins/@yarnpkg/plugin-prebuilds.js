/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-prebuilds",
factory: function (require) {
var plugin;plugin=(()=>{var e={519:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var i=r(966),n=r(688),a=r(62),s=r(794);function o(e,t,r){const i=r.project.configuration,n="@"+e.scope,a=(e.scope?function(e,t){const r=t.get("prebuildScopes").get(e);return void 0!==r?r:null}(n,i):null)||i;return a.get(t)?a.get(t):i.get(t)}function l(e){return(0,s.Vn)(e,"electron")}function u(){switch(process.arch){case"arm":return"armv7l";default:return process.arch}}async function c(e,t,r){const n=i.structUtils.stringifyIdent(e).replace(/^@\w+\//,""),s=e.version,l=r.abi,c=r.runtime,p=process.platform,d=u(),f=process.env.LIBC||"",g=o(e,"prebuildTagPrefix",t),m=`${n}-v${s}-${c}-v${l}-${p}${f}-${d}.tar.gz`,b=o(e,"prebuildHostMirrorUrl",t);if(b){return function(e,t){for(const[r,i]of Object.entries(t))e=e.replace(new RegExp(`{${r}}`,"g"),i);return e}(o(e,"prebuildHostMirrorTemplate",t),{mirror_url:b,name:n,version:s,abi:l,runtime:c,platform:p,arch:d,libc:f,tag_prefix:g,scope:e.scope||"",scopeWithAt:e.scope?"@"+e.scope:"",scopeWithAtAndSlash:e.scope?`@${e.scope}/`:"",scopeWithSlash:e.scope?e.scope+"/":""})}return`${await async function(e,t){var r;const n=await a.npmHttpUtils.get(a.npmHttpUtils.getIdentUrl(e),{configuration:t.project.configuration,ident:e,json:!0});if(!Object.prototype.hasOwnProperty.call(n,"versions"))throw new i.ReportError(i.MessageName.REMOTE_INVALID,'Registry returned invalid data for - missing "versions" field');if(!Object.prototype.hasOwnProperty.call(n.versions,e.version))throw new i.ReportError(i.MessageName.REMOTE_NOT_FOUND,`Registry failed to return reference "${e.version}"`);const s=null===(r=n.versions[e.version].repository)||void 0===r?void 0:r.url;if(!s)throw new i.ReportError(i.MessageName.UNNAMED,`Unable to find repository information for "${i.structUtils.stringifyIdent(e)}"`);const o=function(e){var t=/github\.com\/([^\/]+)\/([^\/\.]+)\.git/.exec(e);return t?`https://github.com/${t[1]}/${t[2]}`:null}(s);if(!o)throw new i.ReportError(i.MessageName.UNNAMED,`Unable to find GitHub URL for "${i.structUtils.stringifyIdent(e)}"`);return o}(e,t)}/releases/download/${g}${s}/${m}`}const p=async(e,t,r,i)=>{if(i.cancel)return;const a=await e.readdirPromise(t);await Promise.all(a.map(async a=>{if(i.cancel)return;const s=n.ppath.join(t,a),o=await e.statPromise(s);o.isDirectory()?await p(e,s,r,i):o.isFile()&&await r(e,s)}))};var d=r(76);const f={prebuildRuntime:{description:"The runtime used, either 'electron' or 'node'",type:i.SettingsType.STRING,default:null},prebuildAbi:{description:"The ABI of the runtime used.",type:i.SettingsType.STRING,default:null},prebuildTagPrefix:{description:"The prebuild tag prefix",type:i.SettingsType.STRING,default:"v"},prebuildHostMirrorUrl:{description:"The prebuild host mirror URL",type:i.SettingsType.STRING,default:null},prebuildHostMirrorTemplate:{description:"The prebuild host mirror template",type:i.SettingsType.STRING,default:"{mirror_url}/{tag_prefix}{version}/{name}-v{version}-{runtime}-v{abi}-{platform}{libc}-{arch}.tar.gz"}},g={hooks:{reduceDependency:async(e,t,r)=>{if("fsevents"===r.name&&"darwin"!==process.platform)return e;if("bindings"===e.name&&null===e.scope){const t=`builtin<prebuild/${i.structUtils.stringifyIdent(r)}>`;return i.structUtils.makeDescriptor(e,i.structUtils.makeRange({protocol:"prebuild:",source:`bindings<${i.structUtils.slugifyIdent(r)}>${process.platform}-${u()}`,selector:t,params:null}))}return e}},fetchers:[class{supports(e,t){return!!e.reference.startsWith("prebuild:")}getLocalPath(e,t){return null}async fetch(e,t){const r=new n.NodeFS,a=await this.fetchPrebuild(e,t),s=a.getRealPath();a.saveAndClose(),await n.xfs.chmodPromise(s,420);const o=`${t.cache.cacheKey}/${await i.hashUtils.checksumFile(s)}`,l=t.cache.getLocatorPath(e,o);if(!l)throw new Error("Assertion failed: Expected the cache path to be available");await n.xfs.movePromise(s,l),await n.xfs.mkdirpPromise(n.ppath.dirname(l));let u=null;const c=await(0,d.getLibzipPromise)();return{packageFs:new n.LazyFS(()=>i.miscUtils.prettifySyncErrors(()=>u=new n.ZipFS(l,{baseFs:r,libzip:c,readOnly:!0}),r=>`Failed to open the cache entry for ${i.structUtils.prettyLocator(t.project.configuration,e)}: ${r}`),n.ppath),releaseFs:()=>{null!==u&&u.discardAndClose()},prefixPath:i.structUtils.getIdentVendorPath(e),localPath:this.getLocalPath(e,t),checksum:o}}async fetchPrebuild(e,t){const{packageIdent:r}=function(e){const t=e.substring(e.indexOf("builtin<prebuild/")+17,e.length-1);return{packageIdent:i.structUtils.parseIdent(t)}}(e.reference),a=await(async e=>{for(const t of e.storedPackages.values())if("electron"===t.name)return t.version;return null})(t.project),s=await(async(e,t,r)=>{for(const r of e.storedPackages.values())if(r.name===t.name&&r.scope===t.scope)return r;return null})(t.project,r);if(null===s)throw new i.ReportError(i.MessageName.UNNAMED,"Could not find the native module that had a prebuild attempt");if(null===s.version)throw new i.ReportError(i.MessageName.UNNAMED,"Could not find the native module version that had a prebuild attempt");const o={abi:a?l(a):process.versions.modules,runtime:a?"electron":"node"},f=await c(s,t,o);let g;try{g=await t.fetcher.fetch(i.structUtils.makeLocator(i.structUtils.makeIdent("prebuilds",`${i.structUtils.slugifyIdent(s)}-v${s.version}-${process.platform}-${u()}-${o.runtime}-${o.abi}`),f),t)}catch(e){throw t.report.reportInfo(i.MessageName.UNNAMED,"Error fetching "+f),e}const m={cancel:!1};let b=null,h="";if(await i.miscUtils.releaseAfterUseAsync(async()=>{await p(g.packageFs,".",async(e,t)=>{b=await e.readFilePromise(t),h=t,m.cancel=!0},m)},g.releaseFs),null===b)throw new i.ReportError(i.MessageName.UNNAMED,`Was unable to find node file in prebuild package for "${i.structUtils.stringifyIdent(s)}"`);const w=await n.xfs.mktempPromise(),y=n.ppath.join(w,"prebuilt.zip"),v=i.structUtils.getIdentVendorPath(e),U=await(0,d.getLibzipPromise)(),P=new n.ZipFS(y,{libzip:U,create:!0});await P.mkdirpPromise(v);const k=new n.CwdFS(v,{baseFs:P});await k.writeJsonPromise("package.json",{name:i.structUtils.slugifyLocator(e),main:"./index.js"});const $=`// Automatically generated bindings file\n// Bindings taken from ${h}\n\nconst staticRequire = require("./bindings.node");\nmodule.exports = (fileLookingFor) => {\n  return staticRequire;\n};\n    `;return await k.writeFilePromise("index.js",$),await k.writeFilePromise("bindings.node",b),P}}],resolvers:[class{supportsDescriptor(e,t){return!!e.range.startsWith("prebuild:")}supportsLocator(e,t){return!!e.reference.startsWith("prebuild:")}shouldPersistResolution(e,t){return!1}bindDescriptor(e,t,r){return e}getResolutionDependencies(e,t){return[]}async getCandidates(e,t,r){if(!r.fetchOptions)throw new Error("Assertion failed: This resolver cannot be used unless a fetcher is configured");return[i.structUtils.makeLocator(i.structUtils.parseIdent("bindings"),e.range)]}async getSatisfying(e,t,r){return null}async resolve(e,t){return{...e,version:"*",languageName:t.project.configuration.get("defaultLanguageName"),linkType:i.LinkType.HARD,dependencies:new Map,peerDependencies:new Map,dependenciesMeta:new Map,peerDependenciesMeta:new Map,bin:new Map}}}],configuration:{...f,prebuildScopes:{description:"Prebuild settings per package scope",type:i.SettingsType.MAP,valueDefinition:{description:"",type:i.SettingsType.SHAPE,properties:{...f}}}}}},896:e=>{"use strict";e.exports=JSON.parse('[{"runtime":"node","target":"11.0.0","lts":false,"future":false,"abi":"67"},{"runtime":"electron","target":"5.0.0","lts":false,"future":false,"abi":"70"},{"runtime":"node","target":"12.0.0","lts":["2019-10-21","2020-10-20"],"future":false,"abi":"68"},{"runtime":"electron","target":"6.0.0","lts":false,"future":false,"abi":"73"},{"runtime":"electron","target":"7.0.0","lts":false,"future":false,"abi":"75"},{"runtime":"electron","target":"8.0.0","lts":false,"future":false,"abi":"76"},{"runtime":"node","target":"13.0.0","lts":false,"future":false,"abi":"74"},{"runtime":"electron","target":"9.0.0","lts":false,"future":false,"abi":"80"},{"runtime":"node","target":"14.0.0","lts":["2020-10-27","2021-10-19"],"future":false,"abi":"81"},{"runtime":"electron","target":"10.0.0-beta.1","lts":false,"future":true,"abi":"82"},{"runtime":"node","target":"15.0.0","lts":false,"future":true,"abi":"84"},{"runtime":"electron","target":"11.0.0-beta.1","lts":false,"future":true,"abi":"85"}]')},794:(e,t,r)=>{var i=r(513);function n(e,t){null==t&&(t=d);var r=t.filter((function(t){return t.runtime===e})).slice(-1)[0],n="electron"===e?"minor":"major";return i.inc(r.target,n)}var a,s,o=(a=r(896),s={supported:[],additional:[],future:[]},a.forEach((function(e){var t={runtime:e.runtime,target:e.target,abi:e.abi};if(e.lts){var r=new Date(Date.parse(e.lts[0])),i=new Date(Date.parse(e.lts[1])),n=new Date;t.lts=r<n&&n<i}else t.lts=!1;"node-webkit"===t.runtime?s.additional.push(t):e.future?s.future.push(t):s.supported.push(t)})),s.supported.sort(),s.additional.sort(),s.future.sort(),s),l=[{runtime:"node",target:"5.0.0",abi:"47",lts:!1},{runtime:"node",target:"6.0.0",abi:"48",lts:!1},{runtime:"node",target:"7.0.0",abi:"51",lts:!1},{runtime:"node",target:"8.0.0",abi:"57",lts:!1},{runtime:"node",target:"9.0.0",abi:"59",lts:!1},{runtime:"node",target:"10.0.0",abi:"64",lts:new Date(2018,10,1)<new Date&&new Date<new Date(2020,4,31)},{runtime:"electron",target:"0.36.0",abi:"47",lts:!1},{runtime:"electron",target:"1.1.0",abi:"48",lts:!1},{runtime:"electron",target:"1.3.0",abi:"49",lts:!1},{runtime:"electron",target:"1.4.0",abi:"50",lts:!1},{runtime:"electron",target:"1.5.0",abi:"51",lts:!1},{runtime:"electron",target:"1.6.0",abi:"53",lts:!1},{runtime:"electron",target:"1.7.0",abi:"54",lts:!1},{runtime:"electron",target:"1.8.0",abi:"57",lts:!1},{runtime:"electron",target:"2.0.0",abi:"57",lts:!1},{runtime:"electron",target:"3.0.0",abi:"64",lts:!1},{runtime:"electron",target:"4.0.0",abi:"64",lts:!1},{runtime:"electron",target:"4.0.4",abi:"69",lts:!1}];l.push.apply(l,o.supported);var u=[{runtime:"node-webkit",target:"0.13.0",abi:"47",lts:!1},{runtime:"node-webkit",target:"0.15.0",abi:"48",lts:!1},{runtime:"node-webkit",target:"0.18.3",abi:"51",lts:!1},{runtime:"node-webkit",target:"0.23.0",abi:"57",lts:!1},{runtime:"node-webkit",target:"0.26.5",abi:"59",lts:!1}];u.push.apply(u,o.additional);var c=[{runtime:"node",target:"0.2.0",abi:"1",lts:!1},{runtime:"node",target:"0.9.1",abi:"0x000A",lts:!1},{runtime:"node",target:"0.9.9",abi:"0x000B",lts:!1},{runtime:"node",target:"0.10.4",abi:"11",lts:!1},{runtime:"node",target:"0.11.0",abi:"0x000C",lts:!1},{runtime:"node",target:"0.11.8",abi:"13",lts:!1},{runtime:"node",target:"0.11.11",abi:"14",lts:!1},{runtime:"node",target:"1.0.0",abi:"42",lts:!1},{runtime:"node",target:"1.1.0",abi:"43",lts:!1},{runtime:"node",target:"2.0.0",abi:"44",lts:!1},{runtime:"node",target:"3.0.0",abi:"45",lts:!1},{runtime:"node",target:"4.0.0",abi:"46",lts:!1},{runtime:"electron",target:"0.30.0",abi:"44",lts:!1},{runtime:"electron",target:"0.31.0",abi:"45",lts:!1},{runtime:"electron",target:"0.33.0",abi:"46",lts:!1}],p=o.future,d=c.concat(l).concat(u).concat(p);t.Vn=function(e,t){if(e===String(Number(e)))return e;if(e&&(e=e.replace(/^v/,"")),t||(t="node"),"node"===t){if(!e)return process.versions.modules;if(e===process.versions.node)return process.versions.modules}for(var r,a=0;a<d.length;a++){var s=d[a];if(s.runtime===t){if(!i.lte(s.target,e))break;r=s.abi}}if(r&&i.lt(e,n(t)))return r;throw new Error("Could not detect abi for version "+e+" and runtime "+t+'.  Updating "node-abi" might help solve this issue if it is a new release of '+t)}},966:e=>{"use strict";e.exports=require("@yarnpkg/core")},688:e=>{"use strict";e.exports=require("@yarnpkg/fslib")},76:e=>{"use strict";e.exports=require("@yarnpkg/libzip")},62:e=>{"use strict";e.exports=require("@yarnpkg/plugin-npm")},513:e=>{"use strict";e.exports=require("semver")}},t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}return r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(519)})();
return plugin;
}
};